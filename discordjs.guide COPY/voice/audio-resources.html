<!DOCTYPE html>
<html lang="en-US">
<head>
	<style>
		:root {
			--c-bg: #fff;
		}

		html.dark {
			--c-bg: #1d1d1d;
		}

		html, body {
			background-color: var(--c-bg);
		}
	</style>
	<script>
		(() => {
			const { classList } = document.documentElement;
			const userMode = localStorage.getItem('guide-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				classList.toggle('dark', true);
			}

			const themes = ['blurple'];
			let colorTheme = localStorage.getItem('guide-color-theme');

			if (colorTheme !== 'default' && !themes.includes(colorTheme)) {
				colorTheme = 'default';
			}

			if (colorTheme !== 'default') classList.add(`guide-theme-${colorTheme}`);
		})();
	</script>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" href="../favicon.png"><meta name="theme-color" content="#3eaf7c"><meta name="twitter:card" content="summary"><meta property="og:title" content="Discord.js Guide"><meta property="og:description" content="Imagine a guide... that explores the many possibilities for your discord.js bot."><meta property="og:type" content="website"><meta property="og:url" content="https://discordjs.guide/"><meta property="og:locale" content="en_US"><meta property="og:image" content="/meta-image.png"><title>Audio Resources | Discord.js Guide</title><meta name="description" content="Imagine a guide... that explores the many possibilities for your discord.js bot.">
<link rel="modulepreload" href="../assets/app.554c1b80.js"><link rel="modulepreload" href="../assets/audio-resources.html.19fe9510.js"><link rel="modulepreload" href="../assets/audio-resources.html.49ff901e.js">
<link rel="stylesheet" href="../assets/style.34d76a50.css">
</head>
<body>
	<div id="app"><!--[--><div class="theme-container"><header class="navbar"><div class="navbar-wrapper"><div class="navbar-links-wrapper"><div class="navbar-links-container"><span class="navbar-links-home"><a href="../index.html" class="">Discord.js Guide</a></span><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="../voice.html" class="nav-link router-link-active" aria-label="Voice"><!--[--><!--]--> Voice <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://discord.js.org/#/docs/main/stable/general/welcome" rel="noopener noreferrer" target="_blank" aria-label="Documentation"><!--[--><!--]--> Documentation <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/discordjs/guide" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--></div><div class="navbar-links-container"><button class="toggle-dark-button"><svg class="icon light-icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="icon dark-icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container" class="navbar-search"></div><div class="toggle-sidebar-button"><svg viewbox="0 0 448 512" class="icon sidebar-menu-icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg><svg viewbox="0 0 24 24" class="icon sidebar-close-icon"><path d="M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41z" fill="currentColor"></path></svg></div></div></div></div></header><div class="content-wrapper"><div class="notifications-wrapper"><div class="notifications"><!--[--><!----><!--]--></div></div><div class="sidebar-mask"></div><div class="sidebar-wrapper"><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="../voice.html" class="nav-link router-link-active" aria-label="Voice"><!--[--><!--]--> Voice <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://discord.js.org/#/docs/main/stable/general/welcome" rel="noopener noreferrer" target="_blank" aria-label="Documentation"><!--[--><!--]--> Documentation <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/discordjs/guide" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><div class="sidebar-group sidebar-group-collapsed"><button class="sidebar-heading sidebar-item"> Settings <svg viewbox="0 0 24 24" class="menu-icon"><path d="M7.41 8.58L12 13.17l4.59-4.59L18 10l-6 6l-6-6l1.41-1.42z" fill="currentColor"></path></svg></button><ul style="display:none;"><li><div class="sidebar-item"><div class="theme-options"><ul class="color-theme-options"><span>Theme</span><li><button class="default-theme" title="Green theme"></button></li><li><button class="blurple-theme" title="Blurple theme"></button></li></ul></div></div></li></ul></div><!--[--><!--[--><p class="sidebar-heading sidebar-item">Home</p><ul class=""><li><!--[--><a href="../index.html" class="nav-link sidebar-item" aria-label="Introduction"><!--[--><!--]--> Introduction <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../requesting-more-content.html" class="nav-link sidebar-item" aria-label="Requesting more content"><!--[--><!--]--> Requesting more content <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../whats-new.html" class="nav-link sidebar-item" aria-label="What&#39;s new"><!--[--><!--]--> What&#39;s new <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">Getting Started</p><ul class=""><li><!--[--><a href="../voice.html" class="nav-link router-link-active sidebar-item" aria-label="Introduction"><!--[--><!--]--> Introduction <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item active">Library</p><ul class=""><li><!--[--><a href="life-cycles.html" class="nav-link sidebar-item" aria-label="Life cycles"><!--[--><!--]--> Life cycles <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="voice-connections.html" class="nav-link sidebar-item" aria-label="Voice Connections"><!--[--><!--]--> Voice Connections <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="audio-player.html" class="nav-link sidebar-item" aria-label="Audio Player"><!--[--><!--]--> Audio Player <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="audio-resources.html" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-item active" aria-label="Audio Resources"><!--[--><!--]--> Audio Resources <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="audio-resources.html#cheat-sheet" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Cheat sheet"><!--[--><!--]--> Cheat sheet <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="audio-resources.html#creation" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Creation"><!--[--><!--]--> Creation <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="audio-resources.html#deletion" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Deletion"><!--[--><!--]--> Deletion <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="audio-resources.html#handling-errors" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Handling errors"><!--[--><!--]--> Handling errors <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="audio-resources.html#optimizations" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Optimizations"><!--[--><!--]--> Optimizations <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="audio-resources.html#not-using-inline-volume" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Not using inline volume"><!--[--><!--]--> Not using inline volume <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="audio-resources.html#playing-opus-streams" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Playing Opus streams"><!--[--><!--]--> Playing Opus streams <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="audio-resources.html#probing-to-determine-stream-type" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Probing to determine stream type"><!--[--><!--]--> Probing to determine stream type <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li></ul><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside></div><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="audio-resources" tabindex="-1"><a class="header-anchor" href="audio-resources.html#audio-resources" aria-hidden="true">#</a> Audio Resources</h1><p>Audio resources contain audio that can be played by an audio player to voice connections.</p><h2 id="cheat-sheet" tabindex="-1"><a class="header-anchor" href="audio-resources.html#cheat-sheet" aria-hidden="true">#</a> Cheat sheet</h2><h3 id="creation" tabindex="-1"><a class="header-anchor" href="audio-resources.html#creation" aria-hidden="true">#</a> Creation</h3><p>There are many ways to create an audio resource. Below are some example scenarios:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> createReadStream <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> join <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> createAudioResource<span class="token punctuation">,</span> StreamType <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@discordjs/voice&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Basic, default options are:</span>
<span class="token comment">// Input type is unknown, so will use FFmpeg to convert to Opus under-the-hood</span>
<span class="token comment">// Inline volume is opt-in to improve performance</span>
<span class="token keyword">let</span> resource <span class="token operator">=</span> <span class="token function">createAudioResource</span><span class="token punctuation">(</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;file.mp3&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Will use FFmpeg with volume control enabled</span>
resource <span class="token operator">=</span> <span class="token function">createAudioResource</span><span class="token punctuation">(</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;file.mp3&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> inlineVolume<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
resource<span class="token punctuation">.</span>volume<span class="token punctuation">.</span><span class="token function">setVolume</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Will play .ogg or .webm Opus files without FFmpeg for better performance</span>
<span class="token comment">// Remember, inline volume is still disabled</span>
resource <span class="token operator">=</span> <span class="token function">createAudioResource</span><span class="token punctuation">(</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;file.ogg&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	inputType<span class="token operator">:</span> StreamType<span class="token punctuation">.</span>OggOpus<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Will play with FFmpeg due to inline volume being enabled.</span>
resource <span class="token operator">=</span> <span class="token function">createAudioResource</span><span class="token punctuation">(</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;file.webm&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	inputType<span class="token operator">:</span> StreamType<span class="token punctuation">.</span>WebmOpus<span class="token punctuation">,</span>
	inlineVolume<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

player<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h3 id="deletion" tabindex="-1"><a class="header-anchor" href="audio-resources.html#deletion" aria-hidden="true">#</a> Deletion</h3><p>The underlying streams of an audio resource are destroyed and flushed once an audio player is done playing their audio. Make sure to remove any references you&#39;ve created to the resource to prevent memory leaks.</p><h2 id="handling-errors" tabindex="-1"><a class="header-anchor" href="audio-resources.html#handling-errors" aria-hidden="true">#</a> Handling errors</h2><p>For most scenarios, you will create an audio resource for immediate use by an audio player. The audio player will propagate errors from the resource for you, so you can attach <code>error</code> handlers to the player instead of the resource.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> createAudioResource<span class="token punctuation">,</span> createAudioPlayer <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@discordjs/voice&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> player <span class="token operator">=</span> <span class="token function">createAudioPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// An AudioPlayer will always emit an &quot;error&quot; event with a .resource property</span>
player<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;Error:&#39;</span><span class="token punctuation">,</span> error<span class="token punctuation">.</span>message<span class="token punctuation">,</span> <span class="token string">&#39;with track&#39;</span><span class="token punctuation">,</span> error<span class="token punctuation">.</span>resource<span class="token punctuation">.</span>metadata<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> resource <span class="token operator">=</span> <span class="token function">createAudioResource</span><span class="token punctuation">(</span><span class="token string">&#39;/home/user/voice/music.mp3&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	metadata<span class="token operator">:</span> <span class="token punctuation">{</span>
		title<span class="token operator">:</span> <span class="token string">&#39;A good song!&#39;</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
player<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>However, you can also attach an error handler specifically to the audio resource if you&#39;d like to. This is <strong>not recommended</strong>, as you are not allowed to change the state of an audio player from the error handlers of an audio resource (on the other hand, you are allowed to do this from the error handle of an audio player, as shown above.)</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> createAudioResource<span class="token punctuation">,</span> createAudioPlayer <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@discordjs/voice&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> player <span class="token operator">=</span> <span class="token function">createAudioPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> resource <span class="token operator">=</span> <span class="token function">createAudioResource</span><span class="token punctuation">(</span><span class="token string">&#39;/home/user/voice/music.mp3&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	metadata<span class="token operator">:</span> <span class="token punctuation">{</span>
		title<span class="token operator">:</span> <span class="token string">&#39;A good song!&#39;</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Not recommended - listen to errors from the audio player instead for most usecases!</span>
resource<span class="token punctuation">.</span>playStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;Error:&#39;</span><span class="token punctuation">,</span> error<span class="token punctuation">.</span>message<span class="token punctuation">,</span> <span class="token string">&#39;with track&#39;</span><span class="token punctuation">,</span> resource<span class="token punctuation">.</span>metadata<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

player<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="optimizations" tabindex="-1"><a class="header-anchor" href="audio-resources.html#optimizations" aria-hidden="true">#</a> Optimizations</h2><p>To improve performance, you can consider the following methods. They reduce the computational demand required to play audio, and could help to reduce jitter in the audio stream.</p><h3 id="not-using-inline-volume" tabindex="-1"><a class="header-anchor" href="audio-resources.html#not-using-inline-volume" aria-hidden="true">#</a> Not using inline volume</h3><p>By default, inline volume is disabled for performance reasons. Enabling it will allow you to modify the volume of your stream in realtime. This comes at a performance cost, even if you aren&#39;t actually modifying the volume of your stream.</p><p>Make sure you consider whether it is worth enabling for your use case.</p><h3 id="playing-opus-streams" tabindex="-1"><a class="header-anchor" href="audio-resources.html#playing-opus-streams" aria-hidden="true">#</a> Playing Opus streams</h3><p>If you are repeatedly playing the same resource, you may consider converting it to Ogg opus or WebM opus. Alternatively, if you are fetching an external resource and are able to specify a format that you&#39;d like to stream the resource in, you should consider specifying Ogg opus or WebM opus.</p><p>The reason for this is that you can remove FFmpeg from the process of streaming audio. FFmpeg is used to convert unknown inputs into Opus audio which can be streamed to Discord. If your audio is already in the Opus format, this removes one of the most computationally demanding parts of the audio pipeline from the streaming process, which would surely improve performance.</p><p>Both of the examples below will skip the FFmpeg component of the pipeline to improve performance.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> createReadStream <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> createAudioResource<span class="token punctuation">,</span> StreamType <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@discordjs/voice&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> resource <span class="token operator">=</span> <span class="token function">createAudioResource</span><span class="token punctuation">(</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">&#39;my_file.ogg&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	inputType<span class="token operator">:</span> StreamType<span class="token punctuation">.</span>OggOpus<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

resource <span class="token operator">=</span> <span class="token function">createAudioResource</span><span class="token punctuation">(</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">&#39;my_file.webm&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	inputType<span class="token operator">:</span> StreamType<span class="token punctuation">.</span>WebmOpus<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>This optimization is useful if you do not want to use inline volume. Enabling inline volume will disable the optimization.</p></div><h3 id="probing-to-determine-stream-type" tabindex="-1"><a class="header-anchor" href="audio-resources.html#probing-to-determine-stream-type" aria-hidden="true">#</a> Probing to determine stream type</h3><p>The voice library is also able to determine whether a readable stream is an Ogg/Opus or WebM/Opus stream. This means that you can still gain the performance benefits that come with playing an Opus stream, even if you aren&#39;t sure in advance what type of audio stream you&#39;ll be playing.</p><p>This is achieved by probing a small chunk of the beginning of the audio stream to see if it is suitable for demuxing:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> createReadStream <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> demuxProbe<span class="token punctuation">,</span> createAudioResource <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@discordjs/voice&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">probeAndCreateResource</span><span class="token punctuation">(</span><span class="token parameter">readableStream</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token punctuation">{</span> stream<span class="token punctuation">,</span> type <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">demuxProbe</span><span class="token punctuation">(</span>readableStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token function">createAudioResource</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> <span class="token punctuation">{</span> inputType<span class="token operator">:</span> type <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">createResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// Creates an audio resource with inputType = StreamType.Arbitrary</span>
	<span class="token keyword">const</span> mp3Stream <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">probeAndCreateResource</span><span class="token punctuation">(</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">&#39;file.mp3&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// Creates an audio resource with inputType = StreamType.OggOpus</span>
	<span class="token keyword">const</span> oggStream <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">probeAndCreateResource</span><span class="token punctuation">(</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">&#39;file.ogg&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// Creates an audio resource with inputType = StreamType.WebmOpus</span>
	<span class="token keyword">const</span> webmStream <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">probeAndCreateResource</span><span class="token punctuation">(</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">&#39;file.webm&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">createResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="nav-link external meta-item-label" href="https://github.com/discordjs/guide/edit/main/guide/voice/audio-resources.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">7/29/2021, 10:30:03 PM</span></div><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"> ← <a href="audio-player.html" class="nav-link" aria-label="Audio Player"><!--[--><!--]--> Audio Player <!--[--><!--]--></a></span><!----></p></nav><!--[--><!--]--></main></div></div><!----><!--]--></div>
	<script type="module" src="../assets/app.554c1b80.js" defer></script>
</body>
</html>
