<!DOCTYPE html>
<html lang="en-US">
<head>
	<style>
		:root {
			--c-bg: #fff;
		}

		html.dark {
			--c-bg: #1d1d1d;
		}

		html, body {
			background-color: var(--c-bg);
		}
	</style>
	<script>
		(() => {
			const { classList } = document.documentElement;
			const userMode = localStorage.getItem('guide-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				classList.toggle('dark', true);
			}

			const themes = ['blurple'];
			let colorTheme = localStorage.getItem('guide-color-theme');

			if (colorTheme !== 'default' && !themes.includes(colorTheme)) {
				colorTheme = 'default';
			}

			if (colorTheme !== 'default') classList.add(`guide-theme-${colorTheme}`);
		})();
	</script>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" href="../favicon.png"><meta name="theme-color" content="#3eaf7c"><meta name="twitter:card" content="summary"><meta property="og:title" content="Discord.js Guide"><meta property="og:description" content="Imagine a guide... that explores the many possibilities for your discord.js bot."><meta property="og:type" content="website"><meta property="og:url" content="https://discordjs.guide/"><meta property="og:locale" content="en_US"><meta property="og:image" content="/meta-image.png"><title>Voice Connections | Discord.js Guide</title><meta name="description" content="Imagine a guide... that explores the many possibilities for your discord.js bot.">
<link rel="modulepreload" href="../assets/app.554c1b80.js"><link rel="modulepreload" href="../assets/voice-connections.html.281304a3.js"><link rel="modulepreload" href="../assets/voice-connections.html.721ba0d2.js">
<link rel="stylesheet" href="../assets/style.34d76a50.css">
</head>
<body>
	<div id="app"><!--[--><div class="theme-container"><header class="navbar"><div class="navbar-wrapper"><div class="navbar-links-wrapper"><div class="navbar-links-container"><span class="navbar-links-home"><a href="../index.html" class="">Discord.js Guide</a></span><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="../voice.html" class="nav-link router-link-active" aria-label="Voice"><!--[--><!--]--> Voice <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://discord.js.org/#/docs/main/stable/general/welcome" rel="noopener noreferrer" target="_blank" aria-label="Documentation"><!--[--><!--]--> Documentation <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/discordjs/guide" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--></div><div class="navbar-links-container"><button class="toggle-dark-button"><svg class="icon light-icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="icon dark-icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container" class="navbar-search"></div><div class="toggle-sidebar-button"><svg viewbox="0 0 448 512" class="icon sidebar-menu-icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg><svg viewbox="0 0 24 24" class="icon sidebar-close-icon"><path d="M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41z" fill="currentColor"></path></svg></div></div></div></div></header><div class="content-wrapper"><div class="notifications-wrapper"><div class="notifications"><!--[--><!----><!--]--></div></div><div class="sidebar-mask"></div><div class="sidebar-wrapper"><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="../voice.html" class="nav-link router-link-active" aria-label="Voice"><!--[--><!--]--> Voice <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://discord.js.org/#/docs/main/stable/general/welcome" rel="noopener noreferrer" target="_blank" aria-label="Documentation"><!--[--><!--]--> Documentation <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/discordjs/guide" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><div class="sidebar-group sidebar-group-collapsed"><button class="sidebar-heading sidebar-item"> Settings <svg viewbox="0 0 24 24" class="menu-icon"><path d="M7.41 8.58L12 13.17l4.59-4.59L18 10l-6 6l-6-6l1.41-1.42z" fill="currentColor"></path></svg></button><ul style="display:none;"><li><div class="sidebar-item"><div class="theme-options"><ul class="color-theme-options"><span>Theme</span><li><button class="default-theme" title="Green theme"></button></li><li><button class="blurple-theme" title="Blurple theme"></button></li></ul></div></div></li></ul></div><!--[--><!--[--><p class="sidebar-heading sidebar-item">Home</p><ul class=""><li><!--[--><a href="../index.html" class="nav-link sidebar-item" aria-label="Introduction"><!--[--><!--]--> Introduction <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../requesting-more-content.html" class="nav-link sidebar-item" aria-label="Requesting more content"><!--[--><!--]--> Requesting more content <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../whats-new.html" class="nav-link sidebar-item" aria-label="What&#39;s new"><!--[--><!--]--> What&#39;s new <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">Getting Started</p><ul class=""><li><!--[--><a href="../voice.html" class="nav-link router-link-active sidebar-item" aria-label="Introduction"><!--[--><!--]--> Introduction <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item active">Library</p><ul class=""><li><!--[--><a href="/djsgc/voice/life-cycles.html" class="nav-link sidebar-item" aria-label="Life cycles"><!--[--><!--]--> Life cycles <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/djsgc/voice-connections.html" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-item active" aria-label="Voice Connections"><!--[--><!--]--> Voice Connections <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/djsgc/voice-connections.html#cheat-sheet" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Cheat sheet"><!--[--><!--]--> Cheat sheet <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/djsgc/voice-connections.html#creation" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Creation"><!--[--><!--]--> Creation <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/djsgc/voice-connections.html#access" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Access"><!--[--><!--]--> Access <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/djsgc/voice-connections.html#deletion" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Deletion"><!--[--><!--]--> Deletion <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/djsgc/voice-connections.html#playing-audio" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Playing audio"><!--[--><!--]--> Playing audio <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/djsgc/voice-connections.html#life-cycle" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Life cycle"><!--[--><!--]--> Life cycle <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/djsgc/voice-connections.html#handling-disconnects" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Handling disconnects"><!--[--><!--]--> Handling disconnects <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a href="/djsgc/voice/audio-player.html" class="nav-link sidebar-item" aria-label="Audio Player"><!--[--><!--]--> Audio Player <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/djsgc/voice/audio-resources.html" class="nav-link sidebar-item" aria-label="Audio Resources"><!--[--><!--]--> Audio Resources <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside></div><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="voice-connections" tabindex="-1"><a class="header-anchor" href="/djsgc/voice-connections.html#voice-connections" aria-hidden="true">#</a> Voice Connections</h1><p>Voice connections represent connections to voice channels in a guild. You can only connect to one voice channel in a guild at a time.</p><p>Voice connections will automatically try their best to re-establish their connections when they move across voice channels, or if the voice server region changes.</p><h2 id="cheat-sheet" tabindex="-1"><a class="header-anchor" href="/djsgc/voice-connections.html#cheat-sheet" aria-hidden="true">#</a> Cheat sheet</h2><h3 id="creation" tabindex="-1"><a class="header-anchor" href="/djsgc/voice-connections.html#creation" aria-hidden="true">#</a> Creation</h3><p>Creating a voice connection is simple:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> joinVoiceChannel <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@discordjs/voice&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">joinVoiceChannel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	channelId<span class="token operator">:</span> channel<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
	guildId<span class="token operator">:</span> channel<span class="token punctuation">.</span>guild<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
	adapterCreator<span class="token operator">:</span> channel<span class="token punctuation">.</span>guild<span class="token punctuation">.</span>voiceAdapterCreator<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>If you try to call <code>joinVoiceChannel</code> on another channel in the same guild in which there is already an active voice connection, the existing voice connection switches over to the new channel.</p><h3 id="access" tabindex="-1"><a class="header-anchor" href="/djsgc/voice-connections.html#access" aria-hidden="true">#</a> Access</h3><p>You can access created connections elsewhere in your code without having to track the connections yourself. It is best practice to not track the voice connections yourself as you may forget to clean them up once they are destroyed, leading to memory leaks.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> getVoiceConnection <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@discordjs/voice&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">getVoiceConnection</span><span class="token punctuation">(</span>myVoiceChannel<span class="token punctuation">.</span>guild<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="deletion" tabindex="-1"><a class="header-anchor" href="/djsgc/voice-connections.html#deletion" aria-hidden="true">#</a> Deletion</h3><p>You can destroy a voice connection when you no longer require it. This will disconnect its connection if it is still active, stop audio playing to it, and will remove it from the internal tracker for voice connections.</p><p>It&#39;s important that you destroy voice connections when they are no longer required so that your bot leaves the voice channel, and to prevent memory leaks.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>connection<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="playing-audio" tabindex="-1"><a class="header-anchor" href="/djsgc/voice-connections.html#playing-audio" aria-hidden="true">#</a> Playing audio</h3><p>You can subscribe voice connections to audio players as soon as they&#39;re created. Audio players will try to stream audio to all their subscribed voice connections that are in the Ready state. Destroyed voice connections cannot be subscribed to audio players.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// Subscribe the connection to the audio player (will play audio on the voice connection)</span>
<span class="token keyword">const</span> subscription <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>audioPlayer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// subscription could be undefined if the connection is destroyed!</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>subscription<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// Unsubscribe after 5 seconds (stop playing audio on the voice connection)</span>
	<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> subscription<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5_000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p><strong>Voice connections can be subscribed to one audio player at most.</strong> If you try to subscribe to another audio player while already subscribed to one, the current audio player is unsubscribed and replaced with the new one.</p><p>It is also worth noting that the <strong>GUILD_VOICE_STATES</strong> <a href="../popular-topics/intents.html#gateway-intents" class="">gateway intent</a> is required. Without it, the connection will permanently stay in the <code>signalling</code> state, and you&#39;ll be unable to play audio.</p></div><h2 id="life-cycle" tabindex="-1"><a class="header-anchor" href="/djsgc/voice-connections.html#life-cycle" aria-hidden="true">#</a> Life cycle</h2><p>Voice connections have their own life cycle, with five distinct states. You can follow the methods discussed in the <a href="/djsgc/voice/life-cycles.html" class="">life cycles</a> section to subscribe to changes to voice connections.</p><ul><li><p><strong>Signalling</strong> - the initial state of a voice connection. The connection will be in this state when it is requesting permission to join a voice channel.</p></li><li><p><strong>Connecting</strong> - the state a voice connection enters once it has permission to join a voice channel and is in the process of establishing a connection to it.</p></li><li><p><strong>Ready</strong> - the state a voice connection enters once it has successfully established a connection to the voice channel. It is ready to play audio in this state.</p></li><li><p><strong>Disconnected</strong> - the state a voice connection enters when the connection to a voice channel has been severed. This can occur even if the connection has not yet been established. You may choose to attempt to reconnect in this state.</p></li><li><p><strong>Destroyed</strong> - the state a voice connection enters when it has been manually been destroyed. This will prevent it from accidentally being reused, and it will be removed from an in-memory tracker of voice connections.</p></li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> VoiceConnectionStatus <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@discordjs/voice&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

connection<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>VoiceConnectionStatus<span class="token punctuation">.</span>Ready<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;The connection has entered the Ready state - ready to play audio!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="handling-disconnects" tabindex="-1"><a class="header-anchor" href="/djsgc/voice-connections.html#handling-disconnects" aria-hidden="true">#</a> Handling disconnects</h2><p>Disconnects can be quite complex to handle. There are 3 cases for handling disconnects:</p><ol><li><p><strong>Resumable disconnects</strong> - there is no clear reason why the disconnect occurred. In this case, voice connections will automatically try to resume the existing session. The voice connection will enter the <code>Connecting</code> state. If this fails, it may enter a <code>Disconnected</code> state again.</p></li><li><p><strong>Reconnectable disconnects</strong> - Discord has closed the connection and given a reason as to why, and that the reason is recoverable. In this case, the voice connection will automatically try to rejoin the voice channel. The voice connection will enter the <code>Signalling</code> state. If this fails, it may enter a <code>Disconnected</code> state again.</p></li><li><p><strong>Potentially reconnectable disconnects</strong> - the bot has either been moved to another voice channel, the channel has been deleted, or the bot has been kicked/lost access to the voice channel. The bot will enter the <code>Disconnected</code> state.</p></li></ol><p>As shown above, the first two cases are covered automatically by the voice connection itself. The only case you need to think carefully about is the third case.</p><p>The third case can be quite problematic to treat as a disconnect, as the bot could simply be moving to another voice channel and so not &quot;truly&quot; disconnected.</p><p>An imperfect workaround to this is to see if the bot has entered a <code>Signalling</code> / <code>Connecting</code> state shortly after entering the <code>Disconnected</code> state. If it has, then it means that the bot has moved voice channels. Otherwise, we should treat it as a real disconnect and not reconnect.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> VoiceConnectionStatus<span class="token punctuation">,</span> entersState <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@discordjs/voice&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

connection<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>VoiceConnectionStatus<span class="token punctuation">.</span>Disconnected<span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">oldState<span class="token punctuation">,</span> newState</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">try</span> <span class="token punctuation">{</span>
		<span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
			<span class="token function">entersState</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span> VoiceConnectionStatus<span class="token punctuation">.</span>Signalling<span class="token punctuation">,</span> <span class="token number">5_000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token function">entersState</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span> VoiceConnectionStatus<span class="token punctuation">.</span>Connecting<span class="token punctuation">,</span> <span class="token number">5_000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// Seems to be reconnecting to a new channel - ignore disconnect</span>
	<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// Seems to be a real disconnect which SHOULDN&#39;T be recovered from</span>
		connection<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="nav-link external meta-item-label" href="https://github.com/discordjs/guide/edit/main/guide/voice/voice-connections.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">11/30/2021, 8:40:06 AM</span></div><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"> ← <a href="/djsgc/voice/life-cycles.html" class="nav-link" aria-label="Life cycles"><!--[--><!--]--> Life cycles <!--[--><!--]--></a></span><span class="next"><a href="/djsgc/voice/audio-player.html" class="nav-link" aria-label="Audio Player"><!--[--><!--]--> Audio Player <!--[--><!--]--></a> → </span></p></nav><!--[--><!--]--></main></div></div><!----><!--]--></div>
	<script type="module" src="../assets/app.554c1b80.js" defer></script>
</body>
</html>
