<!DOCTYPE html>
<html lang="en-US">
<head>
	<style>
		:root {
			--c-bg: #fff;
		}

		html.dark {
			--c-bg: #1d1d1d;
		}

		html, body {
			background-color: var(--c-bg);
		}
	</style>
	<script>
		(() => {
			const { classList } = document.documentElement;
			const userMode = localStorage.getItem('guide-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				classList.toggle('dark', true);
			}

			const themes = ['blurple'];
			let colorTheme = localStorage.getItem('guide-color-theme');

			if (colorTheme !== 'default' && !themes.includes(colorTheme)) {
				colorTheme = 'default';
			}

			if (colorTheme !== 'default') classList.add(`guide-theme-${colorTheme}`);
		})();
	</script>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" href="../favicon.png"><meta name="theme-color" content="#3eaf7c"><meta name="twitter:card" content="summary"><meta property="og:title" content="Discord.js Guide"><meta property="og:description" content="Imagine a guide... that explores the many possibilities for your discord.js bot."><meta property="og:type" content="website"><meta property="og:url" content="https://discordjs.guide/"><meta property="og:locale" content="en_US"><meta property="og:image" content="/meta-image.png"><title>Making a Currency System | Discord.js Guide</title><meta name="description" content="Imagine a guide... that explores the many possibilities for your discord.js bot.">
<link rel="modulepreload" href="../assets/app.554c1b80.js"><link rel="modulepreload" href="../assets/currency.html.3adf0719.js"><link rel="modulepreload" href="../assets/currency.html.676b61ab.js">
<link rel="stylesheet" href="../assets/style.34d76a50.css">
</head>
<body>
	<div id="app"><!--[--><div class="theme-container"><header class="navbar"><div class="navbar-wrapper"><div class="navbar-links-wrapper"><div class="navbar-links-container"><span class="navbar-links-home"><a href="../index.html" class="">Discord.js Guide</a></span><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="../voice.html" class="nav-link" aria-label="Voice"><!--[--><!--]--> Voice <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://discord.js.org/#/docs/main/stable/general/welcome" rel="noopener noreferrer" target="_blank" aria-label="Documentation"><!--[--><!--]--> Documentation <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/discordjs/guide" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--></div><div class="navbar-links-container"><button class="toggle-dark-button"><svg class="icon light-icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="icon dark-icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container" class="navbar-search"></div><div class="toggle-sidebar-button"><svg viewbox="0 0 448 512" class="icon sidebar-menu-icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg><svg viewbox="0 0 24 24" class="icon sidebar-close-icon"><path d="M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41z" fill="currentColor"></path></svg></div></div></div></div></header><div class="content-wrapper"><div class="notifications-wrapper"><div class="notifications"><!--[--><!----><!--]--></div></div><div class="sidebar-mask"></div><div class="sidebar-wrapper"><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="../voice.html" class="nav-link" aria-label="Voice"><!--[--><!--]--> Voice <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://discord.js.org/#/docs/main/stable/general/welcome" rel="noopener noreferrer" target="_blank" aria-label="Documentation"><!--[--><!--]--> Documentation <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/discordjs/guide" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><div class="sidebar-group sidebar-group-collapsed"><button class="sidebar-heading sidebar-item"> Settings <svg viewbox="0 0 24 24" class="menu-icon"><path d="M7.41 8.58L12 13.17l4.59-4.59L18 10l-6 6l-6-6l1.41-1.42z" fill="currentColor"></path></svg></button><ul style="display:none;"><li><div class="sidebar-item"><div class="theme-options"><ul class="color-theme-options"><span>Theme</span><li><button class="default-theme" title="Green theme"></button></li><li><button class="blurple-theme" title="Blurple theme"></button></li></ul></div></div></li></ul></div><!--[--><!--[--><p class="sidebar-heading sidebar-item">Home</p><ul class=""><li><!--[--><a href="../index.html" class="nav-link sidebar-item" aria-label="Introduction"><!--[--><!--]--> Introduction <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../requesting-more-content.html" class="nav-link sidebar-item" aria-label="Requesting more content"><!--[--><!--]--> Requesting more content <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../whats-new.html" class="nav-link sidebar-item" aria-label="What&#39;s new"><!--[--><!--]--> What&#39;s new <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">Installations &amp; Preparations</p><ul class=""><li><!--[--><a href="../preparations/index.html" class="nav-link sidebar-item" aria-label="Installing Node.js and discord.js"><!--[--><!--]--> Installing Node.js and discord.js <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../preparations/setting-up-a-linter.html" class="nav-link sidebar-item" aria-label="Setting up a linter"><!--[--><!--]--> Setting up a linter <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../preparations/setting-up-a-bot-application.html" class="nav-link sidebar-item" aria-label="Setting up a bot application"><!--[--><!--]--> Setting up a bot application <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/djsgc/preparations/adding-your-bot-to-servers.html" class="nav-link sidebar-item" aria-label="Adding your bot to servers"><!--[--><!--]--> Adding your bot to servers <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">Creating Your Bot</p><ul class=""><li><!--[--><a href="../creating-your-bot/index.html" class="nav-link sidebar-item" aria-label="Initial files"><!--[--><!--]--> Initial files <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../creating-your-bot/creating-commands.html" class="nav-link sidebar-item" aria-label="Creating commands"><!--[--><!--]--> Creating commands <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../creating-your-bot/command-handling.html" class="nav-link sidebar-item" aria-label="Command handling"><!--[--><!--]--> Command handling <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../creating-your-bot/event-handling.html" class="nav-link sidebar-item" aria-label="Event handling"><!--[--><!--]--> Event handling <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">Interactions</p><ul class=""><li><!--[--><a href="../interactions/registering-slash-commands.html" class="nav-link sidebar-item" aria-label="Registering slash commands"><!--[--><!--]--> Registering slash commands <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../interactions/replying-to-slash-commands.html" class="nav-link sidebar-item" aria-label="Replying to slash commands"><!--[--><!--]--> Replying to slash commands <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../interactions/slash-command-permissions.html" class="nav-link sidebar-item" aria-label="Slash command permissions"><!--[--><!--]--> Slash command permissions <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../interactions/buttons.html" class="nav-link sidebar-item" aria-label="Buttons"><!--[--><!--]--> Buttons <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../interactions/select-menus.html" class="nav-link sidebar-item" aria-label="Select menus"><!--[--><!--]--> Select menus <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">Popular Topics</p><ul class=""><li><!--[--><a href="../popular-topics/faq.html" class="nav-link sidebar-item" aria-label="Frequently asked Questions"><!--[--><!--]--> Frequently asked Questions <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../popular-topics/threads.html" class="nav-link sidebar-item" aria-label="Threads"><!--[--><!--]--> Threads <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../popular-topics/embeds.html" class="nav-link sidebar-item" aria-label="Embeds"><!--[--><!--]--> Embeds <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../popular-topics/builders.html" class="nav-link sidebar-item" aria-label="Builders"><!--[--><!--]--> Builders <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../popular-topics/reactions.html" class="nav-link sidebar-item" aria-label="Reactions"><!--[--><!--]--> Reactions <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../popular-topics/collectors.html" class="nav-link sidebar-item" aria-label="Collectors"><!--[--><!--]--> Collectors <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../popular-topics/permissions.html" class="nav-link sidebar-item" aria-label="Permissions"><!--[--><!--]--> Permissions <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../popular-topics/permissions-extended.html" class="nav-link sidebar-item" aria-label="Permissions (extended)"><!--[--><!--]--> Permissions (extended) <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../popular-topics/intents.html" class="nav-link sidebar-item" aria-label="Gateway Intents"><!--[--><!--]--> Gateway Intents <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../popular-topics/partials.html" class="nav-link sidebar-item" aria-label="Partial Structures"><!--[--><!--]--> Partial Structures <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../popular-topics/webhooks.html" class="nav-link sidebar-item" aria-label="Webhooks"><!--[--><!--]--> Webhooks <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../popular-topics/errors.html" class="nav-link sidebar-item" aria-label="Errors"><!--[--><!--]--> Errors <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../popular-topics/audit-logs.html" class="nav-link sidebar-item" aria-label="Working with Audit Logs"><!--[--><!--]--> Working with Audit Logs <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../popular-topics/canvas.html" class="nav-link sidebar-item" aria-label="Image manipulation with Canvas"><!--[--><!--]--> Image manipulation with Canvas <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">Miscellaneous</p><ul class=""><li><!--[--><a href="../miscellaneous/parsing-mention-arguments.html" class="nav-link sidebar-item" aria-label="Parsing mentions"><!--[--><!--]--> Parsing mentions <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../miscellaneous/useful-packages.html" class="nav-link sidebar-item" aria-label="Useful packages"><!--[--><!--]--> Useful packages <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item active">Databases</p><ul class=""><li><!--[--><a href="/djsgc/index.html" class="nav-link router-link-active sidebar-item" aria-label="Storing data with Sequelize"><!--[--><!--]--> Storing data with Sequelize <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/djsgc/sequelize/currency.html" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-item active" aria-label="Making a Currency System"><!--[--><!--]--> Making a Currency System <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/djsgc/sequelize/currency.html#file-overview" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="File overview"><!--[--><!--]--> File overview <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/djsgc/sequelize/currency.html#create-models" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Create models"><!--[--><!--]--> Create models <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/djsgc/sequelize/currency.html#initialize-database" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Initialize database"><!--[--><!--]--> Initialize database <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/djsgc/sequelize/currency.html#create-associations" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Create associations"><!--[--><!--]--> Create associations <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/djsgc/sequelize/currency.html#application-code" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Application code"><!--[--><!--]--> Application code <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/djsgc/sequelize/currency.html#alpha-helper-methods" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="[alpha] Helper methods"><!--[--><!--]--> [alpha] Helper methods <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/djsgc/sequelize/currency.html#beta-ready-event-data-sync" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="[beta] Ready event data sync"><!--[--><!--]--> [beta] Ready event data sync <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/djsgc/sequelize/currency.html#gamma-show-user-balance" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="[gamma] Show user balance"><!--[--><!--]--> [gamma] Show user balance <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/djsgc/sequelize/currency.html#delta-show-user-inventory" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="[delta] Show user inventory"><!--[--><!--]--> [delta] Show user inventory <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/djsgc/sequelize/currency.html#epsilon-transfer-currency-to-another-user" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="[epsilon] Transfer currency to another user"><!--[--><!--]--> [epsilon] Transfer currency to another user <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/djsgc/sequelize/currency.html#zeta-buying-an-item" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="[zeta] Buying an item"><!--[--><!--]--> [zeta] Buying an item <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/djsgc/sequelize/currency.html#theta-display-the-shop" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="[theta] Display the shop"><!--[--><!--]--> [theta] Display the shop <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/djsgc/sequelize/currency.html#lambda-display-the-leaderboard" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="[lambda] Display the leaderboard"><!--[--><!--]--> [lambda] Display the leaderboard <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/djsgc/sequelize/currency.html#resulting-code" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="Resulting code"><!--[--><!--]--> Resulting code <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a href="../keyv/index.html" class="nav-link sidebar-item" aria-label="Storing data with Keyv"><!--[--><!--]--> Storing data with Keyv <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">Sharding</p><ul class=""><li><!--[--><a href="../sharding/index.html" class="nav-link sidebar-item" aria-label="Getting started"><!--[--><!--]--> Getting started <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../sharding/additional-information.html" class="nav-link sidebar-item" aria-label="Additional information"><!--[--><!--]--> Additional information <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../sharding/extended.html" class="nav-link sidebar-item" aria-label="Extended changes"><!--[--><!--]--> Extended changes <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">OAuth2</p><ul class=""><li><!--[--><a href="../oauth2/index.html" class="nav-link sidebar-item" aria-label="Getting started with OAuth2"><!--[--><!--]--> Getting started with OAuth2 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">Improving Your Dev Environment</p><ul class=""><li><!--[--><a href="../improving-dev-environment/pm2.html" class="nav-link sidebar-item" aria-label="Managing your bot process with PM2"><!--[--><!--]--> Managing your bot process with PM2 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="https://discordjs.guide/improving-dev-environment/package-json-scripts.html" class="nav-link sidebar-item" aria-label="Setting up package.json scripts"><!--[--><!--]--> Setting up package.json scripts <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">Additional Information</p><ul class=""><li><!--[--><a href="../additional-info/notation.html" class="nav-link sidebar-item" aria-label="Understanding notation"><!--[--><!--]--> Understanding notation <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../additional-info/es6-syntax.html" class="nav-link sidebar-item" aria-label="ES6 syntax examples"><!--[--><!--]--> ES6 syntax examples <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../additional-info/collections.html" class="nav-link sidebar-item" aria-label="Collections"><!--[--><!--]--> Collections <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../additional-info/async-await.html" class="nav-link sidebar-item" aria-label="Understanding async/await"><!--[--><!--]--> Understanding async/await <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../additional-info/rest-api.html" class="nav-link sidebar-item" aria-label="Using a REST API"><!--[--><!--]--> Using a REST API <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="../additional-info/changes-in-v13.html" class="nav-link sidebar-item" aria-label="Updating from v12 to v13"><!--[--><!--]--> Updating from v12 to v13 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside></div><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="making-a-currency-system" tabindex="-1"><a class="header-anchor" href="/djsgc/sequelize/currency.html#making-a-currency-system" aria-hidden="true">#</a> Making a Currency System</h1><p>A common feature of Discord bots is a currency system. It&#39;s possible to do everything in one object, but we can also abstract that in terms of <em>relations</em> between objects. This is where the power of a RDBMS (Relational Database Management System) truly shines. Sequelize calls these <em>associations</em>, so we&#39;ll be using that term from now on.</p><h2 id="file-overview" tabindex="-1"><a class="header-anchor" href="/djsgc/sequelize/currency.html#file-overview" aria-hidden="true">#</a> File overview</h2><p>There will be multiple files: a DB init script, your models, and your bot script. In <a href="/djsgc/index.html" class="">the previous Sequelize guide</a>, we placed all of these in the same file. Having everything in one file isn&#39;t an ideal practice, so we&#39;ll correct that.</p><p>This time we&#39;ll have six files.</p><ul><li><code>app.js</code> is where we&#39;ll keep the main bot code.</li><li><code>dbInit.js</code> is the initialization file for the database. We run this once and forget about it.</li><li><code>dbObjects.js</code> is where we&#39;ll import the models and create associations here.</li><li><code>models/Users.js</code> is the Users model. Users will have a currency attribute in here.</li><li><code>models/CurrencyShop.js</code> is the Shop model. The shop will have a name and a price for each item.</li><li><code>models/UserItems.js</code> is the junction table between the users and the shop. A junction table connects two tables. Our junction table will have an additional field for the amount of that item the user has.</li></ul><h2 id="create-models" tabindex="-1"><a class="header-anchor" href="/djsgc/sequelize/currency.html#create-models" aria-hidden="true">#</a> Create models</h2><p>Here is an entity relation diagram of the models we&#39;ll be making:</p><p><img src="../assets/currency_er_diagram.7160077c.svg" alt="Currency database structure diagram"></p><p><code>Users</code> have a <code>user_id</code>, and a <code>balance</code>. Each <code>user_id</code> can have multiple links to the <code>UserItems</code> table, and each entry in the table connects to one of the items in the <code>CurrencyShop</code>, which will have a <code>name</code> and a <code>cost</code> associated with it.</p><p>To implement this, begin by making a <code>models</code> folder and create a <code>Users.js</code> file inside which contains the following:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">sequelize<span class="token punctuation">,</span> DataTypes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">&#39;users&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
		user_id<span class="token operator">:</span> <span class="token punctuation">{</span>
			type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
			primaryKey<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		balance<span class="token operator">:</span> <span class="token punctuation">{</span>
			type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
			defaultValue<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
			allowNull<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
		timestamps<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>Like you see in the diagram above, the Users model will only have two attributes: a <code>user_id</code> primary key and a <code>balance</code>. A primary key is a particular attribute that becomes the default column used when joining tables together, and it is automatically unique and not <code>null</code>.</p><p>Balance also sets <code>allowNull</code> to <code>false</code>, which means that both values have to be set in conjunction with creating a primary key; otherwise, the database would throw an error. This constraint guarantees correctness in your data storage. You&#39;ll never have <code>null</code> or empty values, ensuring that if you somehow forget to validate in the application that both values are not <code>null</code>, the database would do a final validation.</p><p>Notice that the options object sets <code>timestamps</code> to <code>false</code>. This option disables the <code>createdAt</code> and the <code>updatedAt</code> columns that sequelize usually creates for you. Setting <code>user_id</code> to primary also eliminates the <code>id</code> primary key that Sequelize usually generates for you since there can only be one primary key on a table.</p><p>Next, still in the same <code>models</code> folder, create a <code>CurrencyShop.js</code> file that contains the following:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">sequelize<span class="token punctuation">,</span> DataTypes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">&#39;currency_shop&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
		name<span class="token operator">:</span> <span class="token punctuation">{</span>
			type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
			unique<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		cost<span class="token operator">:</span> <span class="token punctuation">{</span>
			type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
			allowNull<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
		timestamps<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>Like the Users model, timestamps aren&#39;t needed here, so you can disable it. Unlike the Users model, however, the <code>unique</code> field is set to <code>true</code> here, allowing you to change the name without affecting the primary key that joins this to the next object. This gets generated automatically by sequelize since a primary key isn&#39;t set.</p><p>The next file will be <code>UserItems.js</code>, the junction table.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">sequelize<span class="token punctuation">,</span> DataTypes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">&#39;user_item&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
		user_id<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
		item_id<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
		amount<span class="token operator">:</span> <span class="token punctuation">{</span>
			type<span class="token operator">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
			allowNull<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
			<span class="token string">&#39;default&#39;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
		timestamps<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>The junction table will link <code>user_id</code> and the <code>id</code> of the currency shop together. It also contains an <code>amount</code> number, which indicates how many of that item a user has.</p><h2 id="initialize-database" tabindex="-1"><a class="header-anchor" href="/djsgc/sequelize/currency.html#initialize-database" aria-hidden="true">#</a> Initialize database</h2><p>Now that the models are defined, you should create them in your database to access them in the bot file. We ran the sync inside the <code>ready</code> event in the previous tutorial, which is entirely unnecessary since it only needs to run once. You can make a file to initialize the database and never touch it again unless you want to remake the entire database.</p><p>Create a file called <code>dbInit.js</code> in the base directory (<em>not</em> in the <code>models</code> folder).</p><div class="custom-container danger"><p class="custom-container-title">DANGER</p><p>Make sure you use version 5 or later of Sequelize! Version 4, as used in this guide, will pose a security threat. You can read more about this issue on the <a href="https://github.com/sequelize/sequelize/issues/7310" target="_blank" rel="noopener noreferrer">Sequelize issue tracker<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>.</p></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> Sequelize <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;sequelize&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> sequelize <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sequelize</span><span class="token punctuation">(</span><span class="token string">&#39;database&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;username&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;password&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	host<span class="token operator">:</span> <span class="token string">&#39;localhost&#39;</span><span class="token punctuation">,</span>
	dialect<span class="token operator">:</span> <span class="token string">&#39;sqlite&#39;</span><span class="token punctuation">,</span>
	logging<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
	storage<span class="token operator">:</span> <span class="token string">&#39;database.sqlite&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> CurrencyShop <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./models/CurrencyShop.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>sequelize<span class="token punctuation">,</span> Sequelize<span class="token punctuation">.</span>DataTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./models/Users.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>sequelize<span class="token punctuation">,</span> Sequelize<span class="token punctuation">.</span>DataTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./models/UserItems.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>sequelize<span class="token punctuation">,</span> Sequelize<span class="token punctuation">.</span>DataTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> force <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&#39;--force&#39;</span><span class="token punctuation">)</span> <span class="token operator">||</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&#39;-f&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

sequelize<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">{</span> force <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> shop <span class="token operator">=</span> <span class="token punctuation">[</span>
		CurrencyShop<span class="token punctuation">.</span><span class="token function">upsert</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&#39;Tea&#39;</span><span class="token punctuation">,</span> cost<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		CurrencyShop<span class="token punctuation">.</span><span class="token function">upsert</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&#39;Coffee&#39;</span><span class="token punctuation">,</span> cost<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		CurrencyShop<span class="token punctuation">.</span><span class="token function">upsert</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&#39;Cake&#39;</span><span class="token punctuation">,</span> cost<span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">]</span><span class="token punctuation">;</span>

	<span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>shop<span class="token punctuation">)</span><span class="token punctuation">;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Database synced&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	sequelize<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>Here you pull the two models and the junction table from the respective model declarations, sync them, and add items to the shop.</p><p>A new function here is the <code>.upsert()</code> function. It&#39;s a portmanteau for <strong>up</strong>date or in<strong>sert</strong>. <code>upsert</code> is used here to avoid creating duplicates if you run this file multiple times. That shouldn&#39;t happen because <code>name</code> is defined as <em>unique</em>, but there&#39;s no harm in being safe. Upsert also has a nice side benefit: if you adjust the cost, the respective item should also have their cost updated.</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>Execute <code>node dbInit.js</code> to create the database tables. Unless you make a change to the models, you&#39;ll never need to touch the file again. If you change a model, you can execute <code>node dbInit.js --force</code> or <code>node dbInit.js -f</code> to force sync your tables. It&#39;s important to note that this <strong>will</strong> empty and remake your model tables.</p></div><h2 id="create-associations" tabindex="-1"><a class="header-anchor" href="/djsgc/sequelize/currency.html#create-associations" aria-hidden="true">#</a> Create associations</h2><p>Next, add the associations to the models. Create a file named <code>dbObjects.js</code> in the base directory, next to <code>dbInit.js</code>.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> Sequelize <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;sequelize&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> sequelize <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sequelize</span><span class="token punctuation">(</span><span class="token string">&#39;database&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;username&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;password&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	host<span class="token operator">:</span> <span class="token string">&#39;localhost&#39;</span><span class="token punctuation">,</span>
	dialect<span class="token operator">:</span> <span class="token string">&#39;sqlite&#39;</span><span class="token punctuation">,</span>
	logging<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
	storage<span class="token operator">:</span> <span class="token string">&#39;database.sqlite&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Users <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./models/Users.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>sequelize<span class="token punctuation">,</span> Sequelize<span class="token punctuation">.</span>DataTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> CurrencyShop <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./models/CurrencyShop.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>sequelize<span class="token punctuation">,</span> Sequelize<span class="token punctuation">.</span>DataTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> UserItems <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./models/UserItems.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>sequelize<span class="token punctuation">,</span> Sequelize<span class="token punctuation">.</span>DataTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>

UserItems<span class="token punctuation">.</span><span class="token function">belongsTo</span><span class="token punctuation">(</span>CurrencyShop<span class="token punctuation">,</span> <span class="token punctuation">{</span> foreignKey<span class="token operator">:</span> <span class="token string">&#39;item_id&#39;</span><span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token operator">:</span> <span class="token string">&#39;item&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Reflect<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token class-name">Users</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">&#39;addItem&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	<span class="token comment">/* eslint-disable-next-line func-name-matching */</span>
	<span class="token function-variable function">value</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">addItem</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">const</span> userItem <span class="token operator">=</span> <span class="token keyword">await</span> UserItems<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			where<span class="token operator">:</span> <span class="token punctuation">{</span> user_id<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>user_id<span class="token punctuation">,</span> item_id<span class="token operator">:</span> item<span class="token punctuation">.</span>id <span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>userItem<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			userItem<span class="token punctuation">.</span>amount <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> userItem<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">return</span> UserItems<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> user_id<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>user_id<span class="token punctuation">,</span> item_id<span class="token operator">:</span> item<span class="token punctuation">.</span>id<span class="token punctuation">,</span> amount<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Reflect<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token class-name">Users</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">&#39;getItems&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	<span class="token comment">/* eslint-disable-next-line func-name-matching */</span>
	<span class="token function-variable function">value</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">getItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> UserItems<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			where<span class="token operator">:</span> <span class="token punctuation">{</span> user_id<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>user_id <span class="token punctuation">}</span><span class="token punctuation">,</span>
			include<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;item&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span> Users<span class="token punctuation">,</span> CurrencyShop<span class="token punctuation">,</span> UserItems <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>Note that the connection object could be abstracted in another file and had both <code>dbInit.js</code> and <code>dbObjects.js</code> use that connection file, but it&#39;s not necessary to overly abstract things.</p><p>Another new method here is the <code>.belongsTo()</code> method. Using this method, you add <code>CurrencyShop</code> as a property of <code>UserItem</code> so that when you do <code>userItem.item</code>, you get the respectively attached item. You use <code>item_id</code> as the foreign key so that it knows which item to reference.</p><p>You then add some methods to the <code>Users</code> object to finish up the junction: add items to users, and get their current inventory. The code inside should be somewhat familiar from the last tutorial. <code>.findOne()</code> is used to get the item if it exists in the user&#39;s inventory. If it does, increment it; otherwise, create it.</p><p>Getting items is similar; use <code>.findAll()</code> with the user&#39;s id as the key. The <code>include</code> key is for associating the CurrencyShop with the item. You must explicitly tell Sequelize to honor the <code>.belongsTo()</code> association; otherwise, it will take the path of the least effort.</p><h2 id="application-code" tabindex="-1"><a class="header-anchor" href="/djsgc/sequelize/currency.html#application-code" aria-hidden="true">#</a> Application code</h2><p>Create an <code>app.js</code> file in the base directory with the following skeleton code to put it together.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Op <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;sequelize&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Collection<span class="token punctuation">,</span> Client<span class="token punctuation">,</span> Formatters<span class="token punctuation">,</span> Intents <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;discord.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Users<span class="token punctuation">,</span> CurrencyShop <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./dbObjects.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Client</span><span class="token punctuation">(</span><span class="token punctuation">{</span> intents<span class="token operator">:</span> <span class="token punctuation">[</span>Intents<span class="token punctuation">.</span><span class="token constant">FLAGS</span><span class="token punctuation">.</span><span class="token constant">GUILDS</span><span class="token punctuation">,</span> Intents<span class="token punctuation">.</span><span class="token constant">FLAGS</span><span class="token punctuation">.</span><span class="token constant">GUILD_MESSAGES</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> currency <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Collection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// [alpha]</span>

client<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">&#39;ready&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token comment">// [beta]</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Logged in as </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>client<span class="token punctuation">.</span>user<span class="token punctuation">.</span>tag<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

client<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;messageCreate&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">message</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span>author<span class="token punctuation">.</span>bot<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
	currency<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span>author<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

client<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;interactionCreate&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">interaction</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>interaction<span class="token punctuation">.</span><span class="token function">isCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

	<span class="token keyword">const</span> <span class="token punctuation">{</span> commandName <span class="token punctuation">}</span> <span class="token operator">=</span> interaction<span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>commandName <span class="token operator">===</span> <span class="token string">&#39;balance&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// [gamma]</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>commandName <span class="token operator">===</span> <span class="token string">&#39;inventory&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// [delta]</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>commandName <span class="token operator">===</span> <span class="token string">&#39;transfer&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// [epsilon]</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>commandName <span class="token operator">===</span> <span class="token string">&#39;buy&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// [zeta]</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>commandName <span class="token operator">===</span> <span class="token string">&#39;shop&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// [theta]</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>commandName <span class="token operator">===</span> <span class="token string">&#39;leaderboard&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// [lambda]</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

client<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token string">&#39;your-token-goes-here&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><p>Nothing special about this skeleton. You import the Users and CurrencyShop models from our <code>dbObjects.js</code> file and add a currency Collection. Every time someone talks, add 1 to their currency count. The rest is just standard discord.js code and a simple if/else command handler. A Collection is used for the <code>currency</code> variable to cache individual users&#39; currency, so you don&#39;t have to hit the database for every lookup. An if/else handler is used here, but you can put it in a framework or command handler as long as you maintain a reference to the models and the currency collection.</p><h3 id="alpha-helper-methods" tabindex="-1"><a class="header-anchor" href="/djsgc/sequelize/currency.html#alpha-helper-methods" aria-hidden="true">#</a> [alpha] Helper methods</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>Reflect<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>currency<span class="token punctuation">,</span> <span class="token string">&#39;add&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	<span class="token comment">/* eslint-disable-next-line func-name-matching */</span>
	<span class="token function-variable function">value</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> amount</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">const</span> user <span class="token operator">=</span> currency<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			user<span class="token punctuation">.</span>balance <span class="token operator">+=</span> <span class="token function">Number</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> user<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">const</span> newUser <span class="token operator">=</span> <span class="token keyword">await</span> Users<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> user_id<span class="token operator">:</span> id<span class="token punctuation">,</span> balance<span class="token operator">:</span> amount <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		currency<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> newUser<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">return</span> newUser<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Reflect<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>currency<span class="token punctuation">,</span> <span class="token string">&#39;getBalance&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	<span class="token comment">/* eslint-disable-next-line func-name-matching */</span>
	<span class="token function-variable function">value</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">getBalance</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">const</span> user <span class="token operator">=</span> currency<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> user <span class="token operator">?</span> user<span class="token punctuation">.</span>balance <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>This defines an <code>.add()</code> method to our currency collection. You&#39;ll use it quite frequently, so having a method for it makes your life easier. A <code>.getBalance()</code> method is also defined, to ensure that a number is always returned.</p><h3 id="beta-ready-event-data-sync" tabindex="-1"><a class="header-anchor" href="/djsgc/sequelize/currency.html#beta-ready-event-data-sync" aria-hidden="true">#</a> [beta] Ready event data sync</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> storedBalances <span class="token operator">=</span> <span class="token keyword">await</span> Users<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
storedBalances<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">b</span> <span class="token operator">=&gt;</span> currency<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>user_id<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>In the ready event, sync the currency collection with the database for easy access later.</p><h3 id="gamma-show-user-balance" tabindex="-1"><a class="header-anchor" href="/djsgc/sequelize/currency.html#gamma-show-user-balance" aria-hidden="true">#</a> [gamma] Show user balance</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> target <span class="token operator">=</span> interaction<span class="token punctuation">.</span>options<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token string">&#39;user&#39;</span><span class="token punctuation">)</span> <span class="token operator">??</span> interaction<span class="token punctuation">.</span>user<span class="token punctuation">;</span>

<span class="token keyword">return</span> interaction<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>target<span class="token punctuation">.</span>tag<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> has </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>currency<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">💰</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Nothing tricky here. The <code>.getBalance()</code> method is used to show either the author&#39;s or the mentioned user&#39;s balance.</p><h3 id="delta-show-user-inventory" tabindex="-1"><a class="header-anchor" href="/djsgc/sequelize/currency.html#delta-show-user-inventory" aria-hidden="true">#</a> [delta] Show user inventory</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> target <span class="token operator">=</span> interaction<span class="token punctuation">.</span>options<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token string">&#39;user&#39;</span><span class="token punctuation">)</span> <span class="token operator">??</span> interaction<span class="token punctuation">.</span>user<span class="token punctuation">;</span>
<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> Users<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> where<span class="token operator">:</span> <span class="token punctuation">{</span> user_id<span class="token operator">:</span> target<span class="token punctuation">.</span>id <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> items <span class="token operator">=</span> <span class="token keyword">await</span> user<span class="token punctuation">.</span><span class="token function">getItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>items<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span> interaction<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>target<span class="token punctuation">.</span>tag<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> has nothing!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> interaction<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>target<span class="token punctuation">.</span>tag<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> currently has </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>items<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">i</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i<span class="token punctuation">.</span>amount<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i<span class="token punctuation">.</span>item<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;, &#39;</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>This is where you begin to see the power of associations. Even though users and the shop are different tables, and the data is stored separately, you can get a user&#39;s inventory by looking at the junction table and join it with the shop; no duplicated item names that waste space!</p><h3 id="epsilon-transfer-currency-to-another-user" tabindex="-1"><a class="header-anchor" href="/djsgc/sequelize/currency.html#epsilon-transfer-currency-to-another-user" aria-hidden="true">#</a> [epsilon] Transfer currency to another user</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> currentAmount <span class="token operator">=</span> currency<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span>interaction<span class="token punctuation">.</span>user<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> transferAmount <span class="token operator">=</span> interaction<span class="token punctuation">.</span>options<span class="token punctuation">.</span><span class="token function">getInteger</span><span class="token punctuation">(</span><span class="token string">&#39;amount&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> transferTarget <span class="token operator">=</span> interaction<span class="token punctuation">.</span>options<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token string">&#39;user&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>transferAmount <span class="token operator">&gt;</span> currentAmount<span class="token punctuation">)</span> <span class="token keyword">return</span> interaction<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Sorry </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>interaction<span class="token punctuation">.</span>user<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, you only have </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>currentAmount<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>transferAmount <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> interaction<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Please enter an amount greater than zero, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>interaction<span class="token punctuation">.</span>user<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

currency<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>interaction<span class="token punctuation">.</span>user<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token operator">-</span>transferAmount<span class="token punctuation">)</span><span class="token punctuation">;</span>
currency<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>transferTarget<span class="token punctuation">.</span>id<span class="token punctuation">,</span> transferAmount<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> interaction<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Successfully transferred </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>transferAmount<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">💰 to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>transferTarget<span class="token punctuation">.</span>tag<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">. Your current balance is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>currency<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span>interaction<span class="token punctuation">.</span>user<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">💰</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>As a bot creator, you should always be thinking about how to make the user experience better. Good UX makes users less frustrated with your commands. If your inputs are different types, don&#39;t make them memorize which parameters come before the other.</p><p>You&#39;d ideally want to allow users to do both <code>!transfer 5 @user</code> and <code>!transfer @user 5</code>. To get the amount, you can grab the first non-mention text in the command. In the second line of the above code: split the command by spaces and look for anything that doesn&#39;t match a mention; you can assume that&#39;s the transfer amount. Then do some checking to make sure it&#39;s a valid input. You can also do error checking on the transfer target, but we won&#39;t include that here because of its triviality.</p><p><code>.add()</code> is used for both removing and adding currency. Since transfer amounts below zero are disallowed, it&#39;s safe to apply the transfer amount&#39;s additive inverse to their balance.</p><h3 id="zeta-buying-an-item" tabindex="-1"><a class="header-anchor" href="/djsgc/sequelize/currency.html#zeta-buying-an-item" aria-hidden="true">#</a> [zeta] Buying an item</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> itemName <span class="token operator">=</span> interaction<span class="token punctuation">.</span>options<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&#39;item&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> item <span class="token operator">=</span> <span class="token keyword">await</span> CurrencyShop<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> where<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>Op<span class="token punctuation">.</span>like<span class="token punctuation">]</span><span class="token operator">:</span> itemName <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>item<span class="token punctuation">)</span> <span class="token keyword">return</span> interaction<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">That item doesn&#39;t exist.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>cost <span class="token operator">&gt;</span> currency<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span>interaction<span class="token punctuation">.</span>user<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> interaction<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">You currently have </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>currency<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span>interaction<span class="token punctuation">.</span>user<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, but the </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> costs </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>cost<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> Users<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> where<span class="token operator">:</span> <span class="token punctuation">{</span> user_id<span class="token operator">:</span> interaction<span class="token punctuation">.</span>user<span class="token punctuation">.</span>id <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
currency<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>interaction<span class="token punctuation">.</span>user<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token operator">-</span>item<span class="token punctuation">.</span>cost<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> user<span class="token punctuation">.</span><span class="token function">addItem</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> interaction<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">You&#39;ve bought: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>For users to search for an item without caring about the letter casing, you can use the <code>$iLike</code> modifier when looking for the name. Keep in mind that this may be slow if you have millions of items, so please don&#39;t put a million items in your shop.</p><h3 id="theta-display-the-shop" tabindex="-1"><a class="header-anchor" href="/djsgc/sequelize/currency.html#theta-display-the-shop" aria-hidden="true">#</a> [theta] Display the shop</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> items <span class="token operator">=</span> <span class="token keyword">await</span> CurrencyShop<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> interaction<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span>Formatters<span class="token punctuation">.</span><span class="token function">codeBlock</span><span class="token punctuation">(</span>items<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">i</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i<span class="token punctuation">.</span>cost<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">💰</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;\n&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>There&#39;s nothing special here; just a regular <code>.findAll()</code> to get all the items in the shop and <code>.map()</code> to transform that data into something nice looking.</p><h3 id="lambda-display-the-leaderboard" tabindex="-1"><a class="header-anchor" href="/djsgc/sequelize/currency.html#lambda-display-the-leaderboard" aria-hidden="true">#</a> [lambda] Display the leaderboard</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">return</span> interaction<span class="token punctuation">.</span><span class="token function">reply</span><span class="token punctuation">(</span>
	Formatters<span class="token punctuation">.</span><span class="token function">codeBlock</span><span class="token punctuation">(</span>
		currency<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> b<span class="token punctuation">.</span>balance <span class="token operator">-</span> a<span class="token punctuation">.</span>balance<span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">user</span> <span class="token operator">=&gt;</span> client<span class="token punctuation">.</span>users<span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>user_id<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">user<span class="token punctuation">,</span> position</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>position <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">) </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span>users<span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>user_id<span class="token punctuation">)</span><span class="token punctuation">.</span>tag<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>balance<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">💰</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;\n&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Nothing extraordinary here either. You could query the database for the top ten currency holders, but since you already have access to them locally inside the <code>currency</code> variable, you can sort the Collection and use <code>.map()</code> to display it in a friendly format. The filter is in case the users no longer exist in the bot&#39;s cache.</p><h2 id="resulting-code" tabindex="-1"><a class="header-anchor" href="/djsgc/sequelize/currency.html#resulting-code" aria-hidden="true">#</a> Resulting code</h2><p> If you want to compare your code to the code we&#39;ve constructed so far, you can review it over on the GitHub repository <a href="https://github.com/discordjs/guide/tree/main/code-samples/" target="_blank" rel="noopener noreferrer"> here <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>. </p><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="nav-link external meta-item-label" href="https://github.com/discordjs/guide/edit/main/guide/sequelize/currency.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">10/26/2021, 2:41:19 AM</span></div><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"> ← <a href="/djsgc/index.html" class="nav-link router-link-active" aria-label="Storing data with Sequelize"><!--[--><!--]--> Storing data with Sequelize <!--[--><!--]--></a></span><span class="next"><a href="../keyv/index.html" class="nav-link" aria-label="Storing data with Keyv"><!--[--><!--]--> Storing data with Keyv <!--[--><!--]--></a> → </span></p></nav><!--[--><!--]--></main></div></div><!----><!--]--></div>
	<script type="module" src="../assets/app.554c1b80.js" defer></script>
</body>
</html>
